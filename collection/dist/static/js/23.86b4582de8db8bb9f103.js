webpackJsonp([23],{"+gkl":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,a=i("a3Yh"),n=i.n(a),r=i("aA9S"),l=i.n(r),s=i("MDzk"),c=i("XBA1"),d=[{key:"callTypeName",label:"呼叫类型",width:"",id:"2"},{key:"callTime",label:"呼叫时间",width:"150",id:"3"},{key:"answering",label:"通话对象",width:"",id:"4"},{key:"relation",label:"关系",width:"",id:"5"},{key:"callPhone",label:"主叫号码",width:"120",id:"6"},{key:"calledPhone",label:"被叫号码",width:"120",id:"7"},{key:"collectionId",label:"催收员ID",width:"100",id:"9"},{key:"talkTime",label:"计费时长",width:"",id:"14"},{key:"calledTime",label:"通话时长",width:"",id:"10"},{key:"answerStatusName",label:"接听状态",width:"",id:"11"},{key:"caseCode",label:"案件编号",width:"110",id:"13"}],m=(o={components:{},data:function(){return{btnClass:["","","",""],callTime:[],dropdownData:{},tb:{data:[],fields:d},total:0,pageSize:15,currentPage:1,loading:!1,conditionForm:{callTimeMin:"",callTimeMax:"",recordType:"",caseCode:"",tel:"",answering:"",currentPage:1,pageSize:15},hasSearch:!1,audio:null,searchForm:{}}}},n()(o,"components",{tableComponent:s.a,pagination:c.a}),n()(o,"methods",{search:function(){this.searchForm=l()({},this.conditionForm),1==this.conditionForm.currentPage?this.getList(this.conditionForm):(this.conditionForm.currentPage=1,this.getList(this.conditionForm),this.hasSearch=!0)},getdropdownData:function(){var t=this;this.$axios.post("/api/assignee/callRecord/getSearchInfo",{}).then(function(e){0==e.data.code?t.dropdownData=e.data.data:t.$util.failCallback(e.data,t)}).catch(function(t){})},getList:function(t){var e,i=this;e=t||this.conditionForm,this.loading=!0,this.$axios.post("/api/assignee/callRecord/search",e).then(function(t){0==t.data.code?(i.tb.data=t.data.data.items,i.total=t.data.data.totalNum,i.tb.data.map(function(t){t.icon="el-icon-service"})):i.$util.failCallback(t.data,i),i.loading=!1}).catch(function(t){i.loading=!1})},changeSize:function(t){this.conditionForm.pageSize=t,this.searchForm.pageSize=t,1==this.conditionForm.currentPage?this.getList(this.conditionForm):(this.conditionForm.currentPage=1,this.getList(this.conditionForm))},handleCurrentChange:function(t){this.searchForm.currentPage=t,this.hasSearch?(this.getList(this.conditionForm),this.hasSearch=!1):(this.conditionForm=l()({},this.searchForm),this.getList(this.searchForm))},choose:function(t){},handleSelectionChange:function(){},today:function(){if(this.btnClass[0])return!1;this.btnClass=["el-button--primary","","",""],this.conditionForm.callTimeMin=moment().format("YYYY-MM-DD"),this.conditionForm.callTimeMax=moment().format("YYYY-MM-DD")},yesterday:function(){if(this.btnClass[1])return!1;this.btnClass=["","el-button--primary","",""],this.conditionForm.callTimeMin=moment().subtract(1,"days").format("YYYY-MM-DD"),this.conditionForm.callTimeMax=moment().subtract(1,"days").format("YYYY-MM-DD")},lastWeek:function(){if(this.btnClass[2])return!1;this.btnClass=["","","el-button--primary",""],this.conditionForm.callTimeMin=moment().subtract(7,"days").format("YYYY-MM-DD"),this.conditionForm.callTimeMax=moment().subtract(1,"days").format("YYYY-MM-DD")},lastMonth:function(){if(this.btnClass[3])return!1;this.btnClass=["","","","el-button--primary"],this.conditionForm.callTimeMin=moment().subtract(30,"days").format("YYYY-MM-DD"),this.conditionForm.callTimeMax=moment().subtract(1,"days").format("YYYY-MM-DD")},callTimeChange:function(t){this.btnClass=["","","",""],t?(this.conditionForm.callTimeMin=t[0],this.conditionForm.callTimeMax=t[1]):(this.conditionForm.callTimeMin="",this.conditionForm.callTimeMax="")},downloadRecord:function(t){var e=this;this.$axios({method:"post",url:"/api/assignee/callRecord/download",data:{id:t.row.id},responseType:"blob"}).then(function(t){if("application/json"!=t.data.type){var i=t.data,o=new Blob([i]),a=decodeURI(t.headers["content-disposition"].split("=")[1]);if("download"in document.createElement("a")){var n=document.createElement("a");n.download=a,n.style.display="none",n.href=URL.createObjectURL(o),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}else navigator.msSaveBlob(o,a)}else e.$message({type:"error",message:"下载失败"})}).catch(function(t){})},playRecord:function(t){var e=this;this.audio&&this.audio.pause();var i=t.row.id;"string"==typeof t.row.talkTime?t.row.talkTime=Number(t.row.talkTime):t.row.talkTime=String(t.row.talkTime),this.tb.data.map(function(t){t.id!=i&&(t.icon="el-icon-service")}),"el-icon-service"==t.row.icon?(t.row.icon="el-icon-loading",this.$axios({method:"post",url:"/api/assignee/callRecord/download",data:{id:Number(t.row.id)},responseType:"blob"}).then(function(i){if("application/json"!=i.data.type){var o=i.headers["content-disposition"].split("."),a=(o[o.length-1],i.data),n=new Blob([a]);if("download"in document.createElement("a")){e.audio=new Audio,e.audio.src=URL.createObjectURL(i.data),"string"==typeof t.row.talkTime?t.row.talkTime=Number(t.row.talkTime):t.row.talkTime=String(t.row.talkTime);var r=e;t.row.icon="el-icon-more",r.audio.play(),e.audio.onended=function(){"string"==typeof t.row.talkTime?t.row.talkTime=Number(t.row.talkTime):t.row.talkTime=String(t.row.talkTime),r.$message.success("播放完毕"),t.row.icon="el-icon-service"}}else navigator.msSaveBlob(n,fileName)}else e.$message({type:"error",message:"播放失败"}),"string"==typeof t.row.talkTime?t.row.talkTime=Number(t.row.talkTime):t.row.talkTime=String(t.row.talkTime),t.row.icon="el-icon-service"}).catch(function(t){})):"el-icon-more"==t.row.icon?(t.row.icon="el-icon-caret-right",this.audio.pause()):"el-icon-caret-right"==t.row.icon&&(t.row.icon="el-icon-more",this.audio.play())},reset:function(){this.$refs.conditionForm.resetFields(),this.callTime=[],this.callTimeMin=[],this.callTimeMax=[],this.today(),this.getList()}}),n()(o,"created",function(){this.searchForm=l()({},this.conditionForm),this.getdropdownData(),this.getList(this.conditionForm)}),o),h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"content-body"},[t._m(0),t._v(" "),i("div",{staticClass:"bd-main"},[i("el-form",{ref:"conditionForm",attrs:{inline:!0,size:"mini",data:t.conditionForm}},[i("el-form-item",[i("el-radio-group",{attrs:{size:"mini"},on:{change:t.search},model:{value:t.conditionForm.recordType,callback:function(e){t.$set(t.conditionForm,"recordType",e)},expression:"conditionForm.recordType"}},[i("el-radio-button",{attrs:{label:""}},[t._v("全部记录")]),t._v(" "),t._l(t.dropdownData.recordType,function(e){return i("el-radio-button",{key:e.id,attrs:{label:e.code}},[t._v(t._s(e.name))])})],2)],1),t._v(" "),i("el-button-group",[i("el-button",{class:t.btnClass[0],attrs:{size:"mini"},nativeOn:{click:function(e){return t.today(e)}}},[t._v("今天")]),t._v(" "),i("el-button",{class:t.btnClass[1],attrs:{size:"mini"},nativeOn:{click:function(e){return t.yesterday(e)}}},[t._v("昨天")]),t._v(" "),i("el-button",{class:t.btnClass[2],attrs:{size:"mini"},nativeOn:{click:function(e){return t.lastWeek(e)}}},[t._v("过去7天")]),t._v(" "),i("el-button",{class:t.btnClass[3],attrs:{size:"mini"},nativeOn:{click:function(e){return t.lastMonth(e)}}},[t._v("过去30天")])],1),t._v(" "),i("el-date-picker",{attrs:{size:"mini","start-placeholder":"开始日期","end-placeholder":"结束日期",type:"daterange","value-format":"yyyy-MM-dd",format:"yyyy/MM/dd",placeholder:"选择日期",clearable:""},on:{change:t.callTimeChange},model:{value:t.callTime,callback:function(e){t.callTime=e},expression:"callTime"}}),t._v(" "),i("div",[i("el-form-item",{attrs:{label:"案件编号",prop:"caseCode"}},[i("el-input",{attrs:{placeholder:"",size:"mini",clearable:""},model:{value:t.conditionForm.caseCode,callback:function(e){t.$set(t.conditionForm,"caseCode",e)},expression:"conditionForm.caseCode"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"通话对象",prop:"answering"}},[i("el-input",{attrs:{placeholder:"",size:"mini",clearable:""},model:{value:t.conditionForm.answering,callback:function(e){t.$set(t.conditionForm,"answering",e)},expression:"conditionForm.answering"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"通话号码",prop:"tel"}},[i("el-input",{attrs:{placeholder:"",size:"mini",clearable:""},model:{value:t.conditionForm.tel,callback:function(e){t.$set(t.conditionForm,"tel",e)},expression:"conditionForm.tel"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:t.reset}},[t._v("重置")])],1)],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",attrs:{height:"650",data:t.tb.data,"tooltip-effect":"dark","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","empty-text":"暂无数据","show-overflow-tooltip":""}},[t._l(t.tb.fields,function(e){return i("el-table-column",{key:e.id,attrs:{align:e.align||"left",prop:e.key,label:e.label,width:e.width},scopedSlots:t._u([{key:"default",fn:function(o){return[i("span",{class:{"error-result":1==o.row.callType&&1==o.row.answerStatus}},[t._v(t._s(o.row[e.key]))])]}}])})}),t._v(" "),i("el-table-column",{attrs:{width:"80",label:"操作",align:"left",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{class:e.row.icon,attrs:{size:"mini",type:"text"},on:{click:function(i){i.stopPropagation(),i.preventDefault(),t.playRecord(e)}}}),t._v(" "),i("el-button",{staticClass:"el-icon-download",attrs:{size:"mini",type:"text"},on:{click:function(i){i.stopPropagation(),i.preventDefault(),t.downloadRecord(e)}}})]}}])})],2),t._v(" "),i("el-pagination",{attrs:{small:"","current-page":t.conditionForm.currentPage,"page-size":t.conditionForm.pageSize,layout:"sizes,total, prev, pager, next,jumper","page-sizes":[15,50,100],total:t.total},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.$set(t.conditionForm,"currentPage",e)},"size-change":t.changeSize}})],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bd-top"},[e("div",{staticClass:"md clearfix"},[e("div",{staticClass:"md-left"},[e("h5",[this._v("呼叫记录")])]),this._v(" "),e("div",{staticClass:"md-right"})])])}]};var u=i("vSla")(m,h,!1,function(t){i("i4Vf")},"data-v-cf58e31a",null);e.default=u.exports},i4Vf:function(t,e){}});