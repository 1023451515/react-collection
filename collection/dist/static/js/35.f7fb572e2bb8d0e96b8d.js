webpackJsonp([35],{DZ7V:function(e,t){},Qp7d:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("HzJ8"),r=s.n(i),a=(s("6iV/"),{components:{},data:function(){return{sendForm:{content:"",title:"",ids:"",accessory:[]},rules:{title:[{required:!0,message:"必填项",trigger:"blur"},{min:1,max:50,message:"长度在 1 到 50 个字符",trigger:"blur"}],content:[{required:!0,message:"必填项",trigger:"blur"},{min:1,max:500,message:"长度在 1 到 500 个字符",trigger:"blur"}]},fileName:"",fileList:[],formData:{},error:!1,treeLoading:!1,defaultProps:{children:"children",label:"name"},treeData:[],childrenIds:[]}},computed:{},created:function(){this.getList(),this.formData=new FormData},methods:{getList:function(){var e=this;this.treeLoading=!0,this.$axios.post("/api/assignee/notice/receiverList",{}).then(function(t){0==t.data.code?e.treeData=t.data.data:e.$util.failCallback(t.data,e),e.treeLoading=!1}).catch(function(t){e.loading=!1})},announceSend:function(){var e=this;this.$refs.sendForm.validate(function(t){return!!t&&(0==e.childrenIds.length?(e.$alert("请勾选公告对象","提示",{confirmButtonText:"确定"}),!1):e.fileList.length>5?(e.$message.warning("文件数量最多为5"),!1):(e.formData.append("title",e.sendForm.title),e.formData.append("content",e.sendForm.content),e.formData.append("ids",e.childrenIds),void e.$axios.post("/api/assignee/notice/publish",e.formData).then(function(t){0==t.data.code?(e.$message({type:"success",message:"发布成功"}),e.$refs.sendForm.resetFields(),e.deleteFile(),e.resetChecked(),e.fileList=[],e.formData=new FormData):e.$util.failCallback(t.data,e)}).catch(function(e){})))})},handleRemove:function(e,t){},handleSuccess:function(e){0==e.code?(this.$message({type:"success",message:e.msg}),this.$refs.sendForm.resetFields(),this.deleteFile(),this.resetChecked()):this.$message.error(e.msg)},handleChange:function(e,t){var s=this.beforeUpload(e);"ready"==e.status&&s&&(this.fileList[0]=e,this.error=!1)},beforeUpload:function(e){var t=e.size/1024/1024<2;return t||(this.$message.error("上传文件大小不能超过 2MB!"),this.$refs.upload.clearFiles()),t},overAmount:function(){this.$message.error("请先删除上一个文件")},uploadImg:function(){var e=document.getElementById("logo_img").files;if(e&&e.length){var t=!0,s=!1,i=void 0;try{for(var a,n=r()(e);!(t=(a=n.next()).done);t=!0){var l=a.value;if(l.size/1024/1024>2)return this.$message.error("文件不能大于2M"),!1;this.fileList.push(l.name),this.sendForm.accessory.push(l),this.formData.append("accessory",l)}}catch(e){s=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(s)throw i}}}},deleteFile:function(e){this.fileList.splice(e,1),this.sendForm.accessory.splice(e,1),this.formData=new FormData;var t=!0,s=!1,i=void 0;try{for(var a,n=r()(this.sendForm.accessory);!(t=(a=n.next()).done);t=!0){var l=a.value;this.formData.append("accessory",l)}}catch(e){s=!0,i=e}finally{try{!t&&n.return&&n.return()}finally{if(s)throw i}}},setCheckedKeys:function(){this.getchildrenIds(this.treeData),this.$refs.objectTree.setCheckedKeys(this.childrenIds)},resetChecked:function(){this.childrenIds=[],this.$refs.objectTree.setCheckedKeys(this.childrenIds)},getCheckedKeys:function(e,t,s){this.childrenIds=this.$refs.objectTree.getCheckedKeys(!0)},check:function(e){},getchildrenIds:function(e){var t=this;e.forEach(function(e){e.children&&e.children.length>0?t.getchildrenIds(e.children):t.childrenIds.push(e.id)})}}}),n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"content-body"},[e._m(0),e._v(" "),s("div",{staticClass:"bd-main"},[s("el-form",{ref:"sendForm",attrs:{model:e.sendForm,"label-width":"120px",rules:e.rules,size:"mini"}},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:10}},[s("el-form-item",{attrs:{label:"公告标题",prop:"title"}},[s("el-input",{attrs:{placeholder:""},model:{value:e.sendForm.title,callback:function(t){e.$set(e.sendForm,"title",t)},expression:"sendForm.title"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"公告内容",prop:"content"}},[s("el-input",{attrs:{type:"textarea",placeholder:""},model:{value:e.sendForm.content,callback:function(t){e.$set(e.sendForm,"content",t)},expression:"sendForm.content"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"上传附件：",prop:"accessory",rules:[{required:!0,message:"必填项",trigger:"change,blur"}]}},[s("a",{staticClass:"a-upload",attrs:{href:"javascript:;"}},[s("input",{attrs:{type:"file",name:"accessory",id:"logo_img",title:"",multiple:"",clearable:""},on:{change:e.uploadImg}}),e._v("上传附件\n              ")]),e._v(" "),s("ul",{attrs:{id:"fileName"}},e._l(e.fileList,function(t,i){return s("li",{key:t.id,staticClass:"fileName el-upload-list__item is-finished",attrs:{index:i}},[e._v(e._s(t)+"\n                  "),s("i",{staticClass:"el-icon-close",on:{click:function(t){e.deleteFile(i)}}})])}))])],1),e._v(" "),s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:"公告对象",prop:""}},[s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.setCheckedKeys}},[e._v("全选")]),e._v(" "),s("el-button",{attrs:{type:"",size:"mini"},on:{click:e.resetChecked}},[e._v("取消全选")]),e._v(" "),s("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.announceSend}},[e._v("确认发布")]),e._v(" "),s("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"objectTree",attrs:{"show-checkbox":"","highlight-current":"","empty-text":"暂无数据","element-loading-text":"拼命加载中",data:e.treeData,props:e.defaultProps,"node-key":"id","expand-on-click-node":!1,"check-strictly":!1},on:{"check-change":e.getCheckedKeys,check:e.check}})],1)],1)],1)],1)],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bd-top"},[t("div",{staticClass:"md clearfix"},[t("div",{staticClass:"md-left"},[t("h5",[this._v("发布公告")])]),this._v(" "),t("div",{staticClass:"md-right"})])])}]};var l=s("vSla")(a,n,!1,function(e){s("DZ7V")},"data-v-67db9c7d",null);t.default=l.exports}});