webpackJsonp([43],{bh8F:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("aA9S"),a=o.n(i),n=o("a3Yh"),r=o.n(n),l=(o("6iV/"),[{key:"recordingId",label:"录音编号",width:""},{key:"caseCode",label:"案件编号",width:"110"},{key:"batchCode",label:"批次号",width:""},{key:"loanInstitution",label:"贷款机构",width:""},{key:"complaintName",label:"投诉人姓名",width:""},{key:"reportPhone",label:"投诉号码",width:"100"},{key:"complaintReason",label:"投诉原因",width:"100"},{key:"borrowerName",label:"姓名",width:""},{key:"borrowerIdnumber",label:"身份证号",width:"180"},{key:"caseArea",label:"案件地区",width:""},{key:"collectionId",label:"催收员（坐席号）",width:"120"},{key:"callTime",label:"呼叫时间",width:"150"},{key:"talkTime",label:"通话时长",width:""},{key:"relation",label:"关系",width:""}]),c={name:"",components:{pagination:o("XBA1").a},data:function(){var e;return e={dropdownData:[],collectionId:[],currentPage:1,pageSize:15,rules:{borrowerName:[this.$util.formRule.userName],borrowerIdnumber:[this.$util.formRule.ID],reportPhone:[this.$util.formRule.phone],batchCode:[this.$util.formRule.batchCode],caseCode:[this.$util.formRule.caseCode]},loading:!0,pickerOptions2:{onPick:function(e,t){}},conditionForm:{batchCode:"",borrowerIdnumber:"",borrowerName:"",relation:"",callTimeMax:"",callTimeMin:"",caseArea:"",caseCode:"",collectionId:"",loanInstitution:"",talkTime:"",reportPhone:"",currentPage:1,pageSize:10},callTime:[],searchForm:{},hasSearch:!1,total:0,operationBtns:[{name:"播放",identifier:"sponsor_position_search",isShow:!0},{name:"下载",identifier:"sponsor_position_search",isShow:!0}],tb:{fields:l,data:[]},selected:[]},r()(e,"hasSearch",!1),r()(e,"audio",null),e},computed:{basicParams:function(){return{currentPage:this.currentPage,pageSize:15}}},created:function(){this.$route.query.caseCode&&(this.conditionForm.caseCode=this.$util.decrypt(this.$route.query.caseCode,"message"));this.$route.path.slice(1);this.getDownList(),this.searchForm=a()({},this.conditionForm),this.getList(this.conditionForm)},methods:{getDownList:function(){var e=this;this.$axios.post("/api/assignee/complaintPrewarning/getSearchInfo",{}).then(function(t){0==t.data.code?(e.dropdownData=t.data.data,e.dropdownData.loanInstitution.unshift({name:"All",code:""}),e.dropdownData.talkTime.unshift({name:"All",code:""}),e.dropdownData.caseArea.unshift({name:"All",code:""}),e.dropdownData.relation.unshift({name:"All",code:""})):e.$util.failCallback(t.data,e)},function(e){}).catch(function(e){})},callTimeChange:function(e){e?(this.conditionForm.callTimeMin=e[0],this.conditionForm.callTimeMax=e[1]):(this.conditionForm.callTimeMin="",this.conditionForm.callTimeMax="")},remoteMethod:function(e){var t=this;""!==e?this.$axios.post("/api/assignee/complaintPrewarning/getStaff",{collectionId:e}).then(function(e){0==e.data.code?t.collectionId=e.data.data:t.$util.failCallback(e.data,t)}).catch(function(e){}):this.collectionId=[]},handleSelectionChange:function(e){var t=this;this.selected=[],e.forEach(function(e){t.selected.push(e.id)})},playRecord:function(e){var t=this;this.audio&&this.audio.pause();var o=e.row.id;"string"==typeof e.row.batchCode?e.row.batchCode=Number(e.row.batchCode):e.row.batchCode=String(e.row.batchCode),this.tb.data.map(function(e){e.id!=o&&(e.icon="el-icon-service")}),"el-icon-service"==e.row.icon?(e.row.icon="el-icon-loading",this.$axios({method:"post",url:"/api/assignee/complaintPrewarning/download",data:{id:Number(e.row.recordingId)},responseType:"blob"}).then(function(o){if("application/json"!=o.data.type){var i=o.headers["content-disposition"].split("."),a=(i[i.length-1],o.data),n=new Blob([a]);if("download"in document.createElement("a")){t.audio=new Audio,t.audio.src=URL.createObjectURL(o.data),"string"==typeof e.row.batchCode?e.row.batchCode=Number(e.row.batchCode):e.row.batchCode=String(e.row.batchCode),e.row.icon="el-icon-more",t.audio.play();var r=t;t.audio.onended=function(){"string"==typeof e.row.batchCode?e.row.batchCode=Number(e.row.batchCode):e.row.batchCode=String(e.row.batchCode),r.$message.success("播放完毕"),e.row.icon="el-icon-service"}}else navigator.msSaveBlob(n,fileName)}else t.$message({type:"error",message:"播放失败"}),"string"==typeof e.row.batchCode?e.row.batchCode=Number(e.row.batchCode):e.row.batchCode=String(e.row.batchCode),e.row.icon="el-icon-service"}).catch(function(e){})):"el-icon-more"==e.row.icon?(e.row.icon="el-icon-caret-right",this.audio.pause()):"el-icon-caret-right"==e.row.icon&&(e.row.icon="el-icon-more",this.audio.play())},downloadRecord:function(e){var t=this;e.row.recordingId;this.$axios({method:"post",url:"/api/assignee/complaintPrewarning/download",data:{id:Number(e.row.recordingId)},responseType:"blob"}).then(function(e){if("application/json"!=e.data.type){var o=e.data,i=new Blob([o]),a=decodeURI(e.headers["content-disposition"].split("=")[1]);if("download"in document.createElement("a")){var n=document.createElement("a");n.download=a,n.style.display="none",n.href=URL.createObjectURL(i),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}else navigator.msSaveBlob(i,a)}else t.$message({type:"error",message:"下载失败"})}).catch(function(e){})},exportRecord:function(){var e=this;if(!this.selected.length)return this.$alert("请选择录音记录！","提示",{confirmButtonText:"确定",type:"warning"}),!1;this.$axios({method:"post",url:"/api/assignee/complaintPrewarning/batchExport",data:{ids:this.selected},responseType:"blob"}).then(function(t){if("application/json"!=t.data.type){var o=t.data.data,i=new Blob([o]),a=decodeURI(t.headers["content-disposition"].split("=")[1]);if("download"in document.createElement("a")){var n=document.createElement("a");n.download=a,n.style.display="none",n.href=URL.createObjectURL(i),document.body.appendChild(n),n.click(),URL.revokeObjectURL(n.href),document.body.removeChild(n)}else navigator.msSaveBlob(i,a)}else e.$message({type:"error",message:"导出失败"})}).catch(function(e){})},search:function(){var e=this;this.$refs.conditionForm.validate(function(t){t&&(e.searchForm=a()({},e.conditionForm),1==e.conditionForm.currentPage?e.getList(e.conditionForm):(e.conditionForm.currentPage=1,e.getList(e.conditionForm),e.hasSearch=!0))})},resetForm:function(){this.$refs.conditionForm.resetFields(),this.callTime=[],this.conditionForm.callTimeMax="",this.conditionForm.callTimeMin="",this.searchForm=a()({},this.conditionForm),1==this.conditionForm.currentPage?this.getList(this.conditionForm):(this.conditionForm.currentPage=1,this.getList(this.conditionForm),this.hasSearch=!0)},getList:function(e){var t,o=this;t=e||this.conditionForm,this.loading=!0,this.$axios.post("/api/assignee/complaintPrewarning/search",t).then(function(e){o.loading=!1,0==e.data.code?(o.tb.data=e.data.data.items,o.total=e.data.data.totalNum,o.tb.data.map(function(e){e.icon="el-icon-service"})):o.$util.failCallback(e.data,o),o.loading=!1}).catch(function(e){o.loading=!1})},changeSize:function(e){this.conditionForm.pageSize=e,this.searchForm.pageSize=e,1==this.conditionForm.currentPage?this.getList(this.conditionForm):(this.conditionForm.currentPage=1,this.getList(this.conditionForm))},changePage:function(e){this.searchForm.currentPage=e,this.hasSearch?(this.getList(this.conditionForm),this.hasSearch=!1):(this.conditionForm=a()({},this.searchForm),this.getList(this.searchForm))}}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"content-body"},[o("div",{staticClass:"bd-top"},[o("div",{staticClass:"md clearfix"},[e._m(0),e._v(" "),o("div",{staticClass:"md-right"},[o("el-button",{staticStyle:{margin:"4px 20px 0 0"},attrs:{size:"mini",type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.exportRecord(t)}}},[e._v("录音导出")])],1)])]),e._v(" "),o("div",{staticClass:"bd-main"},[o("el-form",{ref:"conditionForm",staticClass:"condition-form",attrs:{model:e.conditionForm,"label-width":this.$util.LABEL_WIDTH,"label-position":"right",size:"mini"}},[o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"姓名",prop:"borrowerName"}},[o("el-input",{attrs:{clearable:""},model:{value:e.conditionForm.borrowerName,callback:function(t){e.$set(e.conditionForm,"borrowerName",t)},expression:"conditionForm.borrowerName"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"身份证",prop:"borrowerIdnumber"}},[o("el-input",{attrs:{clearable:""},model:{value:e.conditionForm.borrowerIdnumber,callback:function(t){e.$set(e.conditionForm,"borrowerIdnumber",t)},expression:"conditionForm.borrowerIdnumber"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"投诉号码",prop:"reportPhone"}},[o("el-input",{attrs:{clearable:""},model:{value:e.conditionForm.reportPhone,callback:function(t){e.$set(e.conditionForm,"reportPhone",t)},expression:"conditionForm.reportPhone"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"案件编号",prop:"caseCode"}},[o("el-input",{attrs:{clearable:""},model:{value:e.conditionForm.caseCode,callback:function(t){e.$set(e.conditionForm,"caseCode",t)},expression:"conditionForm.caseCode"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"贷款机构",prop:"loanInstitution"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.conditionForm.loanInstitution,callback:function(t){e.$set(e.conditionForm,"loanInstitution",t)},expression:"conditionForm.loanInstitution"}},e._l(e.dropdownData.loanInstitution,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.code}})}))],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"批次号",prop:"batchCode"}},[o("el-input",{attrs:{placeholder:""},model:{value:e.conditionForm.batchCode,callback:function(t){e.$set(e.conditionForm,"batchCode",t)},expression:"conditionForm.batchCode"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"催收员",prop:"collectionId"}},[o("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"","remote-method":e.remoteMethod,clearable:"",placeholder:"请输入关键词选择"},model:{value:e.conditionForm.collectionId,callback:function(t){e.$set(e.conditionForm,"collectionId",t)},expression:"conditionForm.collectionId"}},e._l(e.collectionId,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.code}})}))],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"呼叫时间",prop:"latestRepayDate"}},[o("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy/MM/dd HH:mm:ss",type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:""},on:{change:e.callTimeChange},model:{value:e.callTime,callback:function(t){e.callTime=t},expression:"callTime"}})],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"通话时长",prop:"talkTime"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.conditionForm.talkTime,callback:function(t){e.$set(e.conditionForm,"talkTime",t)},expression:"conditionForm.talkTime"}},e._l(e.dropdownData.talkTime,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.code}})}))],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"通话人关系",prop:"relation"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.conditionForm.relation,callback:function(t){e.$set(e.conditionForm,"relation",t)},expression:"conditionForm.relation"}},e._l(e.dropdownData.relation,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.code}})}))],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width"},[o("el-form-item",{attrs:{label:"案件地区",prop:"caseArea"}},[o("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:e.conditionForm.caseArea,callback:function(t){e.$set(e.conditionForm,"caseArea",t)},expression:"conditionForm.caseArea"}},e._l(e.dropdownData.caseArea,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.code}})}))],1)],1),e._v(" "),o("div",{staticClass:"el-col fixed-width form-btns"},[o("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),o("el-button",{attrs:{size:"mini"},on:{click:e.resetForm}},[e._v("重置")])],1)]),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",attrs:{height:"460",data:e.tb.data,"tooltip-effect":"dark","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","show-overflow-tooltip":""},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55",fixed:"left"}}),e._v(" "),e._l(e.tb.fields,function(e){return o("el-table-column",{key:e.id,attrs:{align:e.align||"left",prop:e.key,label:e.label,width:e.width}})}),e._v(" "),e.operationBtns[0].isShow&&e.operationBtns[1].isShow?o("el-table-column",{attrs:{width:"80",label:"操作",align:"left",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.operationBtns[0].isShow?o("el-button",{class:t.row.icon,attrs:{size:"mini",type:"text"},on:{click:function(o){o.stopPropagation(),o.preventDefault(),e.playRecord(t)}}}):e._e(),e._v(" "),e.operationBtns[1].isShow?o("el-button",{staticClass:"el-icon-download",attrs:{size:"mini",type:"text"},on:{click:function(o){o.stopPropagation(),o.preventDefault(),e.downloadRecord(t)}}}):e._e()]}}])}):e._e()],2),e._v(" "),o("pagination",{attrs:{total:e.total,pageSize:e.conditionForm.pageSize,"current-page":e.conditionForm.currentPage},on:{changePage:e.changePage,changeSize:e.changeSize}})],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"md-left"},[t("h5",[this._v("投诉预警")])])}]};var d=o("vSla")(c,s,!1,function(e){o("tKrH")},"data-v-35def201",null);t.default=d.exports},tKrH:function(e,t){}});